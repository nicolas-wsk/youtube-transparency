<!DOCTYPE html>

<head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width">
      <title>AlgoTransparency</title>
      <link rel="icon" type="image/png" href="favicon.png" />
      <meta property="og:url" content="http://algotransparency.org/" />
      <meta property="og:type" content="article" />
      <meta property="og:title" content="YouTube recommended videos" />
      <meta property="og:image" content="/images/youtube-map-mini.jpg"
      />
      <meta property="og:image:type" content="image/jpg" />
      <meta property="og:description" content="AlgoTransparency studied the impact of the YouTube recommendation algorithm." />
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>                       
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>-->
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"><!--
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script> -->

      <!--  jQuery -->
      <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

      <!-- Isolated Version of Bootstrap, not needed if your site already uses Bootstrap -->
      <link rel="stylesheet" href="//formden.com/static/cdn/bootstrap-iso.css" />
      <link rel="stylesheet" href="modifications.css" />

      <!-- Bootstrap Date-Picker Plugin -->
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>

      <link href="//fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
      <link rel="stylesheet" href="/app.css">
      <script src="/app.js"></script>
      <script>
            require('initialize-info');
      </script>

      <script type="text/javascript">
            (function (e, t) {
                  var n = e.amplitude || { _q: [], _iq: {} }; var r = t.createElement("script")
                        ; r.type = "text/javascript"; r.async = true
                        ; r.src = "https://cdn.amplitude.com/libs/amplitude-4.1.0-min.gz.js"
                        ; r.onload = function () {
                              if (e.amplitude.runQueuedFunctions) {
                                    e.amplitude.runQueuedFunctions()
                              } else {
                                    console.log("[Amplitude] Error: could not load SDK")
                              }
                        }
                        ; var i = t.getElementsByTagName("script")[0]; i.parentNode.insertBefore(r, i)
                        ; function s(e, t) {
                        e.prototype[t] = function () {
                              this._q.push([t].concat(Array.prototype.slice.call(arguments, 0))); return this
                        }
                        }
                  var o = function () { this._q = []; return this }
                        ; var a = ["add", "append", "clearAll", "prepend", "set", "setOnce", "unset"]
                        ; for (var u = 0; u < a.length; u++) { s(o, a[u]) } n.Identify = o; var c = function () {
                        this._q = []
                              ; return this
                        }
                        ; var l = ["setProductId", "setQuantity", "setPrice", "setRevenueType", "setEventProperties"]
                        ; for (var p = 0; p < l.length; p++) { s(c, l[p]) } n.Revenue = c
                        ; var d = ["init", "logEvent", "logRevenue", "setUserId", "setUserProperties", "setOptOut", "setVersionName", "setDomain", "setDeviceId", "setGlobalUserProperties", "identify", "clearUserProperties", "setGroup", "logRevenueV2", "regenerateDeviceId", "logEventWithTimestamp", "logEventWithGroups", "setSessionId"]
                        ; function v(e) {
                              function t(t) {
                              e[t] = function () {
                                    e._q.push([t].concat(Array.prototype.slice.call(arguments, 0)))
                              }
                              }
                              for (var n = 0; n < d.length; n++) { t(d[n]) }
                        } v(n); n.getInstance = function (e) {
                              e = (!e || e.length === 0 ? "$default_instance" : e).toLowerCase()
                                    ; if (!n._iq.hasOwnProperty(e)) { n._iq[e] = { _q: [] }; v(n._iq[e]) } return n._iq[e]
                        }
                        ; e.amplitude = n
            })(window, document);

            amplitude.getInstance().init("ac83dc709767bb0f32724a7edff4e715");
            amplitude.getInstance().logEvent('Index Loaded');
      </script>
</head>

<body>
      <section class="hero is-small">
            <!-- Hero header: will stick at the top -->
            <div class="hero-head">
                  <header class="nav nav-first">
                        <div class="nav-bar">
                              <div class="nav-left">
                                    <a class="nav-item" href="index.html">
                                          <strong>AlgoTransparency</strong>
                                    </a>
                              </div>
                              <span class="nav-toggle">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                              </span>
                              <div class="nav-right nav-menu">
                                    <a class="nav-item" href="/en/science.html">
                                          Themes
                                    </a>
                                    <a class="nav-item" href="/youtube.html">
                                          YouTube Map
                                    </a>
                                    <a class="nav-item showIntro">
                                          Watch intro
                                    </a>
                                    <a class="nav-item" href="/methodology.html">
                                          About
                                    </a>
                                    <a class="nav-item" href="/en/press.html">
                                          Media Coverage
                                    </a>
                                    <div class="twitter-btn">
                                          <a href="https://twitter.com/helloalgo?ref_src=twsrc%5Etfw" class="twitter-follow-button"
                                                data-size="large" data-show-screen-name="false" data-lang="en" data-show-count="false">Follow @helloalgo</a>
                                          <script async src="https://platform.twitter.com/widgets.js"
                                                charset="utf-8"></script>
                                    </div>
                              </div>
                        </div>
                  </header>
                  <div class="search-space">
                              <div class="container column is-8 is-offset-2">
                                    <div class="info-title">
                                          <div class="info-title-in col-xs-12">
                                                Videos History
                                                <div class="info-title-sub col-xs-12"> From more than <a href="methodology.html" class="bold-link">1000 channels</a>. See methodology <a href="methodology.html" class="bold-link">here</a>.</div>
                                          </div>
                                          </div>
                                          <div class="search-group">
                                                <div class="col-xs-6">
                                                      <div class="input-group">
                                                            <div>
                                                                  <label for="srch-term">FILTER TITLES / CHANNELS</label>
                                                                  <input type="text" class="form-control straight-box" placeholder='Try "Trump" or "Kavanaugh"' name="srch-term" id="srch-term">
                                                            </div>
                                                      </div>
                                                </div>
                                                <div class="col-xs-4">
                                                      <div class='input-group date' id='datetimepicker1'>
                                                            <label class="control-label" for="date">DATE</label>
                                                            <input class="form-control noradius" id="date" name="date" placeholder="MM/DD/YYY" type="text" data-date-end-date="0d"/>

                                                            <!-- <label for="date-picker">DATE</label>
                                                            <input type='text' class="form-control" id="date-picker"/>
                                                            <div class="input-group-addon">
                                                                  <span class="glyphicon glyphicon-calendar"></span>
                                                            </div> -->
                                                      </div>
                                                </div>
                                                <div class="col-xs-2">
                                                      <button class="btn search-btn btn-danger" name="submit" type="submit">Filter</button>
                                                </div>

                                                <div class="col-xs-12 last-section">
                                                      <button class="btn search-btn timeperiod" name="timeperiod_day" id="timeperiod_day" type="submit">1 day</button>
                                                      <button class="btn select-btn timeperiod" name="timeperiod_3days" id="timeperiod_3days" type="submit">3 days</button>
                                                      <button class="btn select-btn timeperiod" name="timeperiod_week" id="timeperiod_week" type="submit">1 week</button>
                                                      <button class="btn select-btn timeperiod" name="timeperiod_month" id="timeperiod_month" type="submit">1 month</button>
                                                      <span style="margin-left:20px;"></span>
                                                      <!-- Empty Button -->
                                                      <!-- <button class="btn btn-ok" name="france-btn" type="submit" style="opacity:0;">1 month</button> -->
                                                      <button class="btn search-btn region" id="region_us-info" type="submit">USA</button>
                                                      <button class="btn search-btn region" id="region_france-info" type="submit">FRANCE</button>

                                                      <button class="btn select-btn sort" id="sort_r" type="submit">Sort by Channels Recommending It</button>
                                                      <button class="btn select-btn sort" id="sort_v" type="submit">Sort by View Increase</button>
                                                </div>
                                          </div>
                              </div>
                        </div>
                  </div>
            </div>
      </section>
      <section class="section columns">
            <div class="container column is-8 is-offset-2">
                  <div class="sink-wrapper sink-videos">
                  </div>
                  <div class="box-wrapper presentation mb1" id="presentation"></div>
            </div>
      </section>
      <section class="section columns" style="padding-bottom:50px">
            <div class="container column is-6 is-offset-2">
                  <!-- <header class="box-wrapper video-header">
                        <div class="box-title">Top 100 videos</div>
                        <span class="float-right">
                              <span class="video-date" id="video__date">
                                    <span id="nb_video"></span> videos collected on</span>
                              <span class="select is-small">
                                    <select id="video-select">
                                          <option value="ytrecos-science-2018-08-01">1st of August 2018</option>
                                    </select>
                              </span>
                        </span>
                  </header> -->
                  <!-- <div class="box-wrapper videos">
                  </div> -->
            </div>
            <!-- <div class="container column is-2">
                  <!--<section class="sidebar-right">
            <strong class="is-block">Représentation des candidats</strong>
               <small>dans les titres de vidéos mentionant un candidat</small>
         </section>-->
                  <!-- <section class="box-wrapper sidebar-right box-wrapper mb1">
                        <div class="box-title mb2">Frequent terms mentioned in the titles of these videos:</div>
                        <div id="representation"></div>
                  </section> -->
                  <!-- <section class="box-wrapper mb1">
                        <div class="box-title mb2">Our project</div>
                        <p class="mb1">AlgoTransparency is designed to inform citizens on the algorithms shaping access to information.
                              <a href="/en/demarche.html">Find out more</a>
                        </p>
                        <div class="mb2">
                              <span class="small">
                                    <div class="twitter-btn-2">
                                          <a href="https://twitter.com/helloalgo?ref_src=twsrc%5Etfw" class="twitter-follow-button"
                                                data-size="large" data-show-screen-name="false" data-lang="en" data-show-count="false">Follow @helloalgo</a>
                                          <script async src="https://platform.twitter.com/widgets.js"
                                                charset="utf-8"></script>
                                    </div>
                              </span>
                              <!-- <div class="addthis_inline_follow_toolbox"></div> -->
                        <!-- </div>
                        <small>Developed with help from
                              <a href="http://www.dataforgood.fr/">Data for Good</a>
                        </small> -->
                  <!-- </section> -->
            <!-- </div> -->
            <section class="is-2 column"></section>
      </section>
      <button id="more" class="btn search-btn btn-danger" style="margin-left: auto;margin-right: auto;display: block;margin-bottom: 30px;" name="submit" type="submit">Display more...</button>
      <section id="intro">
            <div class="slides-container has-text-centered">
                  <button class="btn btn__absolute btn__next btn--highlighted">Next</button>
                  <section class="pagination"> </section>
                  <section class="slide slide-1">
                        <h1 class="mt4">On YouTube, there are</h1>
                        <h1 class="mt4"></h1>
                        <h1 class="mt4"></h1>
                        <img class="slide-image image-small mb2" style="max-width: 500px;margin: 0 auto;" src="/images/youtube-stats.png" alt="">
                  </section>
                  <section class="slide slide-2">
                        <h1>YouTube’s recommendation algorithm</h1>
                        <h1>generates more than <span class="redbold">70%</span> of views</h1>
                        <h1> &nbsp; </h1>
                        <h1> &nbsp; </h1>
                        <h1> &nbsp; </h1>
                        <h1> &nbsp; </h1>
                        <h1> &nbsp; </h1>
                        <h2 class="">That's <span class="redbold">700, 000, 000</span> human hours, every single day.</h2>
                  </section>
                  <section class="slide slide-3">
                        <h1 class="">But what did YouTube recommend?</h1>
                        <h2 class="mb4">Today, it’s impossible to tell</h2>
                        <img class="slide-image image-large" src="/images/slide-3.jpg" alt="">
                        <!-- <h2 class="mb4">Some people claim they are being sensored. Is that true?</h2> -->
                  </section>
                  <section class="slide slide-4">
                        <h1 class="">To find out, we created a robot</h1>
                        <h2 class="mb4">Every day, it starts from 1000 channels, follows recommendations, and save videos</h2>
                        <img class="slide-image image-large pt4" src="/images/slide-4-uk.gif" alt="">
                        <h2 class="mb4">What videos were recommended by the algorithm?</h2>
                  </section>
            </div>
      </section>

      <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58ea64fc4724e90a"></script>

      <script>

            (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                  (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                  m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-97331997-1', 'auto');
            ga('send', 'pageview');

var results_shown = 0;

function getUrlVar(key) {
   const result = new RegExp(key + '=([^&]*)', 'i').exec(window.location.search);
   return (result && unescape(result[1])) || '';
}

function getUrlVarOrDefault(key, def) {
   const result = new RegExp(key + '=([^&]*)', 'i').exec(window.location.search);
   return (result && unescape(result[1])) || def;
}

function updateButtons(elem_id) {
      var domain = elem_id.split('_')[0]
      var value = elem_id.split('_')[1]
      changeUrlParam(domain, value)
      $('.' + domain).removeClass('search-btn');
      $('.' + domain).addClass('select-btn');
      $('#' + elem_id).addClass('search-btn');
}

function toggle_elem(elem_id) {
      updateButtons(elem_id)
      updateDate()
}

$('#timeperiod_day').on("click", function(){ toggle_elem('timeperiod_day'); });
$('#timeperiod_3days').on("click", function(){ toggle_elem('timeperiod_3days'); });
$('#timeperiod_week').on("click", function(){ toggle_elem('timeperiod_week'); });
$('#timeperiod_month').on("click", function(){ toggle_elem('timeperiod_month'); });

$('#region_us-info').on("click", function(){ toggle_elem('region_us-info'); });
$('#region_france-info').on("click", function(){ toggle_elem('region_france-info'); });

$('#sort_v').on("click", function(){ toggle_elem('sort_v'); });
$('#sort_r').on("click", function(){ toggle_elem('sort_r'); });


function changeUrlParam(param, value) {
   const currentURL = window.location.href + '&';
   const change = new RegExp('(' + param + ')=(.*)&', 'g');
   const newURL = currentURL.replace(change, '$1=' + value + '&');

   if (getURLParameter(param) !== null) {
      try {
         window.history.replaceState('', '', newURL.slice(0, -1));
      } catch (err) {
         console.err(err);
      }
   } else {
      const currURL = window.location.href;
      if (currURL.indexOf('?') !== -1) {
         window.history.replaceState(
        '',
        '',
        currentURL.slice(0, -1) + '&' + param + '=' + value
      );
      } else {
         window.history.replaceState(
        '',
        '',
        currentURL.slice(0, -1) + '?' + param + '=' + value
      );
      }
   }
}

function getURLParameter(name) {
   return (
    decodeURIComponent(
      (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(
        location.search
      ) || [, ''])[1]
        .replace(/\+/g, '%20')
    ) || null
   );
}

let jsonLocal = {};
const jsonThemeLocal = {};

function updateDate(){
      // if ($('#date').val() == '') {
      //       if (getUrlVar('date') && getUrlVar('date') != '') {
      //             var french_format = getUrlVar('date')
      //             $('#date').val(french_format[3]+french_format[4]+'/'+ french_format[0] + french_format[1] + '/20'+french_format[8]+french_format[9])
      //       } else {
      //             console.log(' New date ')
      //             var today = new Date();
      //             today.setDate(today.getDate() - 1);
      //             if (today.getDate() == 10 && today.getMonth()+1 ==12 && today.getFullYear() == 2018) {
      //                   today = new Date();
      //             }
      //             var dd = today.getDate();
      //             var mm = today.getMonth()+1; //January is 0!
      //             var yyyy = today.getFullYear();

      //             if(dd<10) {
      //                   dd = '0'+dd
      //             } 
      //             if(mm<10) {
      //             mm = '0'+mm
      //             }
      //             today = mm + '/' + dd + '/' + yyyy;
      //             $('#date').val(today)
      //       }
      // }

      // var d= $('#date').val()
      // var filedate = d[3]+d[4]+'-'+d[0]+d[1]+'-'+d[6]+d[7]+d[8]+d[9]
      // const lastDate = filedate;
      // console.log('Date =')
      // console.log(lastDate)

      // let url = lastDate; //  getUrlVar('file') || 
      // if (getUrlVar('file')) {
      // $('#video-select').children().each(function() {
      //       if ($(this)[0].value === getUrlVar('file')) $(this)[0].selected = true;
      // });
      // }

      var region = getUrlVarOrDefault('region', 'us-info')
      var timeperiod = getUrlVarOrDefault('timeperiod', 'day')
      var sorting = getUrlVarOrDefault('sort', 'r')

      var js_file = 'evo-' + region + '-' + timeperiod + '-' + sorting

      console.log('TRYING TO GET DATA from file "' + js_file + '"');
      $.get('/data/info/' + js_file + '.json', function(data) {
            console.log('GOT DATA from file ' + js_file);
            jsonLocal = data;
            let count = 0;
            Object.keys(jsonLocal).forEach((item) => {
                  count += jsonLocal[item].length;
            });
            console.log(count)
            $('#nb_video').append(count);

            // let random = Math.floor(Math.random() * Object.keys(jsonLocal).length);
            let key = 'info_channels';
            // changeUrlParam('date', url);
            appendSinkHoles();
      });
}

function number_format(number, decimals, dec_point, thousands_sep) {
    // http://kevin.vanzonneveld.net
    // +   original by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // +     bugfix by: Michael White (http://getsprink.com)
    // +     bugfix by: Benjamin Lupton
    // +     bugfix by: Allan Jensen (http://www.winternet.no)
    // +    revised by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
    // +     bugfix by: Howard Yeend
    // +    revised by: Luke Smith (http://lucassmith.name)
    // +     bugfix by: Diogo Resende
    // +     bugfix by: Rival
    // +      input by: Kheang Hok Chin (http://www.distantia.ca/)
    // +   improved by: davook
    // +   improved by: Brett Zamir (http://brett-zamir.me)
    // +      input by: Jay Klehr
    // +   improved by: Brett Zamir (http://brett-zamir.me)
    // +      input by: Amir Habibi (http://www.residence-mixte.com/)
    // +     bugfix by: Brett Zamir (http://brett-zamir.me)
    // +   improved by: Theriault
    // +   improved by: Drew Noakes
    // *     example 1: number_format(1234.56);
    // *     returns 1: '1,235'
    // *     example 2: number_format(1234.56, 2, ',', ' ');
    // *     returns 2: '1 234,56'
    // *     example 3: number_format(1234.5678, 2, '.', '');
    // *     returns 3: '1234.57'
    // *     example 4: number_format(67, 2, ',', '.');
    // *     returns 4: '67,00'
    // *     example 5: number_format(1000);
    // *     returns 5: '1,000'
    // *     example 6: number_format(67.311, 2);
    // *     returns 6: '67.31'
    // *     example 7: number_format(1000.55, 1);
    // *     returns 7: '1,000.6'
    // *     example 8: number_format(67000, 5, ',', '.');
    // *     returns 8: '67.000,00000'
    // *     example 9: number_format(0.9, 0);
    // *     returns 9: '1'
    // *    example 10: number_format('1.20', 2);
    // *    returns 10: '1.20'
    // *    example 11: number_format('1.20', 4);
    // *    returns 11: '1.2000'
    // *    example 12: number_format('1.2000', 3);
    // *    returns 12: '1.200'
    var n = !isFinite(+number) ? 0 : +number, 
        prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
        sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
        dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
        toFixedFix = function (n, prec) {
            // Fix for IE parseFloat(0.55).toFixed(0) = 0;
            var k = Math.pow(10, prec);
            return Math.round(n * k) / k;
        },
        s = (prec ? toFixedFix(n, prec) : Math.round(n)).toString().split('.');
    if (s[0].length > 3) {
        s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
    }
    if ((s[1] || '').length < prec) {
        s[1] = s[1] || '';
        s[1] += new Array(prec - s[1].length + 1).join('0');
    }
    return s.join(dec);
}

function print_item(id){
      console.log('https://www.youtube.com/watch?v=' + id)
}

function approximateViews(list, idx) {
      var previous_val=0;
      var previous_idx=-1;
      var next_val=0;
      var next_idx=-1;
      for (var i=0; i < list.length; i++){
            if (i<idx && list[i]>0) {
                  previous_val=list[i]
                  previous_idx=i
            }
            if (i>idx && list[i]>0) {
                  next_val=list[i]
                  next_idx=i
                  break;
            }
      }(i)
      if (previous_idx === -1 || next_idx === -1) {
            return 0
      }
      return Math.round(previous_val) + Math.round(((idx-previous_idx)*(next_val-previous_val)/(next_idx-previous_idx)))
}

function isFilteredOutVideo(vid, specific_video) {
      return specific_video && vid.indexOf(specific_video) == -1
}

var click_bait_chans = ["Lama Faché", "PaZ Tv 2", "DAM - Documentaires Auto / Moto", "BusinessattitudeTV", "AndykunTOP", "ChrisDetek", "C'd'oufS !", "Univers du Top", "Les Meilleurs Tops", "Abd El-Hakim Abu Issa 'Abd El-Haqq", "Alphadelta06", "Morgan VS", "VIDEOHOLIC", "Eureka", "The Armchair Historian", "Fans de Stars" , "GoPro World", "Busted Locals", "Pour le plaisir", "BEST OF CULTES", "Life Funny", "ROIBOLOSS", "Garry's School", "Automoto", "SYMPA", "MagieExpliquée", "Univers du Top", "vfr800fiem",  "MAGELLAN TV fr", "WatchMojo Français", "Dream List"]

function channelIsNotClickbait(chan) {
      return click_bait_chans.indexOf(chan) === -1
}

function addSinkHoles(init, end) {
  // Compute the sinkholes
  var counts = {}
  var videos_info = {}
  var dates = []
  for (var key in jsonLocal) {
    console.log('Specific video = ' + specific_video)
    // check if the property/key is defined in the object itself, not in parent
    if (jsonLocal.hasOwnProperty(key)) {
        if (key === 'dates') {
          dates = jsonLocal[key]
          continue;
        } 

        jsonLocal[key].filter((item) => item.likes !== -1).forEach((item, index) => {
        counts[item.id] = (counts[item.id] || 0) + 1;
        videos_info[item.id] = item
      })
    }
  }

  var key = 'videos' 
  var sorted_counts = Object.keys(counts).map(function(key) {
    return [key, counts[key]];
  });

  // Sort the array based on the second element
  sorted_counts.sort(function(first, second) {
      return second[1] - first[1];
  });

  var specific_video = getUrlVar('v')

  var filtered_data = jsonLocal[key]

  console.log(getUrlVar('cleaner'))
  if (getUrlVar('cleaner') === '1') {
      console.log('Cleaner activé')
      filtered_data = jsonLocal[key].filter((item) => channelIsNotClickbait(item.channel))
  }

  var filtered_vids = filtered_data.filter((item) => item.likes !== -1 && !isFilteredOutVideo(item.id, specific_video)).map(function(item) {
    return [item.id, 0];
  })

//   var filtered_vids = jsonLocal[key].filter((item) => item.likes !== -1).map(function(item) {
//     return [item.id, 0];
//   })

  if (filtered_vids.length == 0) {
      $('.sink-videos').append(
    `
      <div class="sinkhole">No data available for that date and keywords. Please select a different date or keywords.<div>
    `
      )
  }
  if (getUrlVar('cleaner') === '1') {
      $('.sink-videos').append(
    `
      <div style="margin:40px;font-style:italic;">The following channels have been removed because they mostly not do infos: <strong>${click_bait_chans.join(', ')}</strong><div>
    `
      )
  }
  console.log('Number of stuff')
  console.log(filtered_vids)

  // Computing the global max channels for all items   
//   let max_chans = 0;
//   filtered_vids.forEach((elem) => {
//     var item = videos_info[elem[0]];
//       for (var i=0;i<item.chan_history.length;i++) {
//             if (item.chan_history[i] > max_chans) {
//                   max_chans = item.chan_history[i]
//             }
//       }
//   })
//   const max_recos = 1000000

  filtered_vids.slice(init, end).forEach((elem, index) => {
    var item = videos_info[elem[0]];
    const views = item.views > 0 ? `${number_format(item.views)} views` : '';
    const multiplicator = item['nb_chans_rec'];
    const obs_recos = item['observed_recos']
    const mult = multiplicator ? `
          <div class="mult right" data-balloon-length="large" data-balloon="YouTube recommended this video from ${multiplicator} different channels"><div class="mult-text"> Number of channels recommending it: </div><div class="mult-yy"><strong>${Math.round(multiplicator * 10) / 10} </strong></div>
          <div class="right" data-balloon-length="large" data-balloon="The algorithm recommended this video at least ${number_format(obs_recos)} times, and probably much more"><div class="mult-text"> Recommendations: </div><div class="mult-yy"><strong>${number_format(obs_recos)}</strong</div>
          </div>`
      : '';
      var max_local_chans=0;
      var days_ago=0;
      for (var i=0;i<item.chan_history.length;i++) {
            if (item.chan_history[i] > max_local_chans) {
                  max_local_chans = item.chan_history[i]
                  max_chans_date = dates[i]
            }
      }

      if (item.views > 0 && multiplicator > 0) {
            var like_comment = ''
            if (item.likes > 10 && item.dislikes >10) {
                  var ratio = item.likes / (item.likes + item.dislikes)
                  var ratio_v = Math.floor((1-ratio)*100)
                  var warnings = ''
                  for (var i=0; i < Math.floor((1-ratio) * 10); i++) {
                        warnings += `⚠️`
                  }
                  like_comment = `<div style="color:#DD2726;font-weight:bold;margin-top:15px;"> ${ratio_v} % dislikes ${warnings} </div>`
            }

      var v7da = item.view_history[item.view_history.length-8]
      if (v7da < 10){
            v7da = approximateViews(item.view_history, item.view_history.length-8)
      }

      var vlw = item.views - v7da
      var test = getUrlVar('file').indexOf('week') === -1 // getUrlVar('file').indexOf('week') === -1
      var last_week_views = test ? '' : `${number_format(vlw)} views this week`
      console.log(last_week_views)

      var order_number =  `<div style="font-size: 25px;font-weight: bold;color:#DD2726;margin-left:20px;margin-top:15px;">${last_week_views}</div>`

      $('.sink-videos').append(
      `
          ${order_number}
          <div class="box">
          <article class="media">
              <figure class="media-left level">
                <a href="https://www.youtube.com/watch?v=${item.id}" target="_blank">
                    <div class="is-inline-block level-item">
                      <img class="image" width="170px" src="https://img.youtube.com/vi/${item.id}/hqdefault.jpg">
                    </div>
                </a>
              </figure>
              <div class="media-content">
                <div class="content">
                    <a class="video-title" href="https://www.youtube.com/watch?v=${item.id}" target="_blank">${item.title}</a>
                    <div class="channel-title">${item.channel}</div>
                    <div><small class="video-stats" style="color:#7ed868;font-weight:bold;">` +
                        views +
              `<i class="fa fa-thumbs-up" aria-hidden="true" onclick="print_item('${item.id}')"></i>
                    ${number_format(item.likes)}
                    <span style="color:#DD2726"><i class="fa fa-thumbs-down" aria-hidden="true"></i>${number_format(item.dislikes)}</span>${like_comment}</small></div>
                </div>
              </div>
              </article>
            </div>
          <div style="font-weight:bold; margin-left:20px;margin-top:15px;">
            <span style="color:#ff6b9a;font-size:25px;font-weight:bold">${number_format(obs_recos)}</span> recommendations to this video were observed
          </div>
            <div style="font-weight:bold; margin-left:20px;margin-top:15px;">
            <span style="color:darkblue;font-size:25px;font-weight:bold">${max_local_chans}</span> different channels had recommendations to this video on ${max_chans_date}
          </div>
          <div style="font-weight:bold; margin-left:20px; margin-top: 10px;">
            <span style="color:darkblue;font-size:15px;font-weight:bold">${item['nb_chans_rec']}</span> different channels had recommendations to this video in total
          </div>
        `);

      var max_views = 0
      for (var i=0;i<item.view_history.length;i++) {
            if (item.view_history[i] - max_views > 0) {
                  max_views = item.view_history[i]
            }
      }

      var bar_percent = 100 / (item.view_history.length + 10)
      if (bar_percent > 10) {
            bar_percent = 10
      }

      var view_size = 100
      for (var i=0;i<item.view_history.length;i++) {
            var video_date = dates[i]
            var barHeight= Math.round(view_size * item.view_history[i]/max_views)

            if (item.view_history[i] >0) {
                  $('.sink-videos').append(
                  `
                        <div style="height:${barHeight}px;margin:-1px -1.4px; color: #7ed868;background-color: #7ed868;width:${bar_percent}%;display:inline-block" data-balloon-length="large" data-balloon="This video had ${number_format(item.view_history[i])} views on ${video_date}">${item.view_history[i]>0 ?'':'?'}</div>
                  `)
            } else {
                  var approx_views = approximateViews(item.view_history, i)
                  barHeight = Math.round(view_size * approx_views/max_views)
                  $('.sink-videos').append(
                  `
                        <div style="height:${barHeight}px;margin:-1px -1.4px; color: #dcf5d6;background-color: #dcf5d6;width:${bar_percent}%;display:inline-block" data-balloon-length="large" data-balloon="This video had around ${approx_views>0 ? number_format(approx_views): 'unknown '} views (interpollated number) on ${video_date}"></div>
                  `)
            }
      }
      $('.sink-videos').append(
      `
            <div style="margin-top:0px;margin-bottom:15px; margin-left:10px;font-weight: bold; font-style:italic;text-align:center;border-top-style: solid;border-width: 1px;margin-top: -5px;border-color: #7ed868;"> Number of views </div>
      `)

      var view_size = 50
      for (var i=0;i<item.like_history.length;i++) {
            var video_date = dates[i]
            if (item.like_history[i] > 0) {
                  var likes = Math.round(item.like_history[i])
                  var dislikes = Math.round(item.dislike_history[i])
                  var ratio_likes = likes / (likes + dislikes)
                  var barHeight= Math.round(view_size * ratio_likes)
                  $('.sink-videos').append(
                  `
                        <div style="height:${barHeight}px; margin:-1px -1.4px; color: #00ccff;background-color: #00ccff;width:${bar_percent}%;display:inline-block" data-balloon-length="large" data-balloon="This video had ${ratio_likes}% likes on ${video_date}">${item.like_history[i]>0 ?'':'?'}</div>
                  `)
            } else {
                  var approx_likes = approximateViews(item.like_history, i)
                  var approx_dislikes = approximateViews(item.dislike_history, i)
                  var ratio_likes = approx_likes/(approx_likes + approx_dislikes)
                  var barHeight= Math.round(view_size * ratio_likes)
                  $('.sink-videos').append(
                  `
                        <div style="height:${barHeight}px; margin:-1px -1.4px; color: #ccf5ff;background-color: #ccf5ff;width:${bar_percent}%;display:inline-block" data-balloon-length="large" data-balloon="This video had around ${ratio_likes ? ratio_likes : 'unknown '}% likes (interpollated number) on ${video_date}"></div>
                  `)

            }
      }

      $('.sink-videos').append(
      `
            <div style="margin-top:0px;margin-bottom:15px; margin-left:10px;font-weight: bold; font-style:italic;text-align:center;border-top-style: solid;border-width: 1px;margin-top: -5px;border-color: #00ccff;"> Percentage of likes </div>
      `)

      var max_recos = 0
      for (var i=0;i<item.reco_history.length;i++) {
            if (item.reco_history[i] - max_recos > 0) {
                  max_recos = item.reco_history[i]
            }
      }

      for (var i=0;i<item.reco_history.length;i++) {
            var video_date = dates[i]
            var barHeight= Math.round(view_size * item.reco_history[i]/max_recos)
            $('.sink-videos').append(
            `
                  <div style="height:${barHeight}px; margin:-1px -1.4px; background-color: #ff6b9a;width:${bar_percent}%;display:inline-block" data-balloon-length="large" data-balloon="This video was recommended at least ${number_format(item.reco_history[i])} times on ${video_date}"></div>
            `)
      }
      $('.sink-videos').append(
      `
            <div style="margin-top:0px;margin-bottom:15px; margin-left:10px;font-weight: bold; font-style:italic;text-align:center;border-top-style: solid;border-width: 1px;margin-top: -5px;border-color: #ff6b9a;">Observed recommendations to this videos</div>
      `)

      var max_chans = 0
      for (var i=0;i<item.chan_history.length;i++) {
            if (item.chan_history[i] - max_chans > 0) {
                  max_chans = item.chan_history[i]
            }
      }

      for (var i=0;i<item.chan_history.length;i++) {
            var video_date = dates[i]
            var barHeight= Math.round(view_size * item.chan_history[i]/max_chans)
            $('.sink-videos').append(
            `
                  <div style="height:${barHeight}px; margin:-1px -1.4px; background-color: darkblue;width:${bar_percent}%;display:inline-block" data-balloon-length="large" data-balloon="This video was recommended from at least ${item.chan_history[i]} channels on ${video_date}"></div>
            `)
      }
      $('.sink-videos').append(
      `
            <div style="margin-top:0px;margin-bottom:15px; margin-left:10px;font-weight: bold; font-style:italic;text-align:center;border-top-style: solid;border-width: 1px;margin-top: -5px;border-color: darkblue;"> Number of channels that recommended this videos </div>
      `)
      $('.sink-videos').append(
      `
            <span style="margin-top:10px;font-weight:bold;">Channels with more than 100k subscribers from which this video was recommended: </span>
      `)
      for (var i=0;i<item.top_chans_rec.length;i++) {
            $('.sink-videos').append(
      `
            <span><a href="https://www.youtube.com/results?search_query=${item.top_chans_rec[i]}">${item.top_chans_rec[i]}</a>,</span>
      `)
      }
      $('.sink-videos').append(
      `
            <div style="margin-bottom:100px;font-weight:bold;"></div><hr>
      `)

  }})
}

function appendSinkHoles() {
  $('#panel-block-all').addClass('is-active');
  $('.sink-videos').empty()
  $('#presentation').hide()
  $('.video-header').hide()
  $('.videos').hide()
  $('.video-header').show()
  $('.videos').show()

  results_shown = 10
  addSinkHoles(0, results_shown);
};

window.onscroll = function(ev) {
    if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight) {
        results_shown = results_shown + 10
        addSinkHoles(results_shown-10, results_shown);
    }
};

function hideIntro(){
      $('#intro').hide();
}

$(document).ready(function() {
      $('#srch-term').on('input',function(e){
            appendSinkHoles();
      });

      $.get("../data/*", function(data) {
            console.log('Initialize');
      });

      updateButtons('region' + '_' + getUrlVarOrDefault('region', 'us-info'))
      updateButtons('timeperiod' + '_' + getUrlVarOrDefault('timeperiod', '3days'))
      updateButtons('sort' + '_' + getUrlVarOrDefault('sort', 'r'))

      updateDate()
      var date_input=$('input[name="date"]'); //our date input has the name "date"
      var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
      var options={
            format: 'mm/dd/yyyy',
            container: container,
            todayHighlight: true,
            startDate: '10-06-2018',
            autoclose: true,
      };
      date_input.datepicker(options).on('changeDate',function(event){
            console.log('select')
            updateDate()
      });
});
      </script>
</body>